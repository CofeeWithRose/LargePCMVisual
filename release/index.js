!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(){return n={},o.m=r=[function(t,e,r){"use strict";r.r(e),r.d(e,"WaveRolling",function(){return I});var h=function(){this.length=0,this.segments=new Array},n=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var a=arguments[e],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},o=(a.prototype.addListener=function(t,e){(this.eventMap[t]=this.eventMap[t]||[]).push(e)},a.prototype.removeListeners=function(t){delete this.eventMap[t]},a.prototype.removeListener=function(t,e){var r,n=this.eventMap[t];n&&(n.length?-1<(r=n.indexOf(e))&&n.splice(r,1):delete this.eventMap[t])},a.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];n(this.eventMap[t]||[]).forEach(function(t){try{t.apply(void 0,e)}catch(t){console.error(t)}})},a);function a(){this.eventMap={}}var i=(s.prototype.addListener=function(t,e){document.body.click,this.listeners.addListener(t,e)},s.prototype.removeListener=function(t,e){this.listeners.removeListener(t,e)},s.prototype.removeListeners=function(t){this.listeners.removeListeners(t)},s.prototype.trigger=function(t,e){var r=this.triggerProcess[t];r?this.listeners.emit(t,r(e)):console.warn("Trigger Error. you must setTriggerProcesser for [ "+t+" ].")},s.prototype.setTriggerProcesser=function(t,e){this.triggerProcess[t]=e},s.prototype.clearListener=function(){this.listeners=new o},s);function s(){this.triggerProcess={},this.listeners=new o}var c,f,u=((c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(l,f=i),l.prototype.decode=function(t){this.dataBufferCache=[],this.dataBufferRangeList=[];var e=this.getWavInfo(t),r=e.sampleRate,n=e.numOfChannels,o=e.headBuffer,a=e.dataBuffer,i=e.totalDataByteLength,s=e.bitsPerSample,c=e.ByteRate,f=e.duration;this.perDataBufferPiceLength=r*n*s/8,this.ByteRate=c,this.duration=f;var h=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!h)throw this.onerror(new Error("Not Suport Error")),"Not Suport Error";this.audioContext=new h(1,this.perDataBufferPiceLength,44100),this.totalDataBufferLength=i,this.headerBuffer=o,this.decodedDataByteLength=0,this.lastCacheIndex=0,this.cachedDataByteLength=0,this.cacheOffset=0,this.cacheDataBufferList(a),this.decodeBufferPice(),this.decode=function(){}},l.prototype.appendBuffer=function(t){var e=this.cachedDataByteLength>=this.totalDataBufferLength,r=!this.dataBufferRangeList.length;this.cacheDataBufferList(t),!e&&r&&this.decodeBufferPice()},l.prototype.abort=function(){this.trigger("abort"),this.release()},l.prototype.release=function(){this.dataBufferCache=[],this.dataBufferRangeList=[],this.perDataBufferPiceLength=0,this.ByteRate=0,this.duration=0,this.totalDataBufferLength=0,this.headerBuffer=new ArrayBuffer(0),this.decodedDataByteLength=0,this.lastCacheIndex=0,this.cachedDataByteLength=0,this.cacheOffset=0,this.decodeBufferPice=function(){},this.appendBuffer=function(){},this.removeListeners("process"),this.removeListeners("waitting"),this.removeListeners("complete")},l.prototype.cacheDataBufferList=function(t){this.dataBufferCache.push(t);var e,r,n=this.dataBufferCache.length-1,o=0;this.tempBufferRange&&(e=this.totalDataBufferLength-this.cachedDataByteLength,r=(r=this.perDataBufferPiceLength-this.tempBufferRange.length)<=e?r:e,t.byteLength>=r?(this.tempBufferRange.segments.push({cacheIndex:n,offset:o,length:r,cacheOffset:this.cacheOffset}),this.tempBufferRange.length+=r,this.cachedDataByteLength+=r,o+=r,this.dataBufferRangeList.push(this.tempBufferRange),this.tempBufferRange=new h):(this.tempBufferRange.segments.push({cacheIndex:n,offset:o,length:t.byteLength,cacheOffset:this.cacheOffset}),this.tempBufferRange.length+=t.byteLength,this.cachedDataByteLength+=t.byteLength,o+=t.byteLength));for(var a=Math.floor((t.byteLength-o)/this.perDataBufferPiceLength),i=0;i<a;i++)this.dataBufferRangeList.push({segments:[{cacheIndex:n,offset:o,length:this.perDataBufferPiceLength,cacheOffset:this.cacheOffset}],length:this.perDataBufferPiceLength}),o+=this.perDataBufferPiceLength,this.cachedDataByteLength+=this.perDataBufferPiceLength;var s,c,f=t.byteLength-o;f&&(this.cachedDataByteLength+f>=this.totalDataBufferLength?(s=this.totalDataBufferLength-this.cachedDataByteLength,this.dataBufferRangeList.push({segments:[{cacheIndex:n,offset:o,length:s,cacheOffset:this.cacheOffset}],length:s}),this.cachedDataByteLength=this.totalDataBufferLength):(c=t.byteLength-o,this.tempBufferRange={segments:[{cacheIndex:n,offset:o,length:c,cacheOffset:this.cacheOffset}],length:c},this.cachedDataByteLength+=c))},l.prototype.decodeBufferPice=function(){var t,n=this,o=this.dataBufferRangeList.shift();o?(t=this.getRangeAuidoBuffer(o),this.audioContext.decodeAudioData(t,function(t){var e=n.decodedDataByteLength/n.ByteRate;n.decodedDataByteLength+=o.length;var r=n.decodedDataByteLength>=n.totalDataBufferLength;r||n.decodeBufferPice(),n.trigger("process",{audioBuffer:t,startTime:e,endTime:n.decodedDataByteLength/n.ByteRate,duration:n.duration}),r&&(n.dataBufferCache=[],n.trigger("complete"),n.release())},function(t){return n.trigger("error",new Error("Format Error"))})):this.trigger("waitting")},l.prototype.getRangeAuidoBuffer=function(t){var c=this,e=t.segments,r=t.length,n=new ArrayBuffer(this.headerBuffer.byteLength+r),f=new Uint8Array(n),h=0;this.setWavHeadDataLength(r);var o=new Uint8Array(this.headerBuffer);return f.set(o),h+=this.headerBuffer.byteLength,e.forEach(function(t){var e=t.cacheIndex,r=t.offset,n=t.length,o=t.cacheOffset;e-o!==c.lastCacheIndex&&(c.dataBufferCache.shift(),c.cacheOffset--,c.lastCacheIndex=e-o);var a=e+c.cacheOffset-o,i=c.dataBufferCache[a],s=new Uint8Array(i,r,n);f.set(s,h),h+=n}),n},l.prototype.setWavHeadDataLength=function(t){new DataView(this.headerBuffer).setUint32(this.dataLengthOffset,t,!0)},l.prototype.getWavInfo=function(t){var e=new DataView(t),r=this.getString(e,0,4),n=this.getString(e,8,4);if("RIFF"!==r||"WAVE"!==n)throw this.trigger("error",new Error("Format Error.")),"Format Error";this.dataLengthOffset=this.getDataOffset(e);var o=e.getUint32(this.dataLengthOffset,!0),a=e.getUint16(22,!0),i=e.getUint32(24,!0),s=e.getUint32(28,!0);return{bitsPerSample:e.getUint16(34,!0),sampleRate:i,numOfChannels:a,headBuffer:t.slice(0,this.dataLengthOffset+4),dataBuffer:t.slice(this.dataLengthOffset+4,this.dataLengthOffset+4+o),totalDataByteLength:o,ByteRate:s,duration:o/s}},l.prototype.getDataOffset=function(t){for(var e=20+t.getUint32(16,!0);;){if("data"===this.getString(t,e,4))return 4+e;e+=t.getUint32(e+4,!0)+4+4}},l.prototype.getString=function(t,e,r){for(var n="",o=0;o<r;o++)n+=String.fromCharCode(t.getUint8(e+o));return n},l.prototype.onprocess=function(t){},l.prototype.onwaitting=function(){},l.prototype.oncomplete=function(){},l.prototype.onabort=function(){},l.prototype.onerror=function(t){console.error(t)},l);function l(){var e=f.call(this)||this;return e.setTriggerProcesser("process",function(t){return t}),e.setTriggerProcesser("waitting",function(){}),e.setTriggerProcesser("complete",function(){}),e.setTriggerProcesser("abort",function(){}),e.setTriggerProcesser("error",function(t){return t}),e.addListener("process",function(t){return e.onprocess(t)}),e.addListener("waitting",function(){return e.onwaitting()}),e.addListener("complete",function(){return e.oncomplete()}),e.addListener("abort",function(){return e.onabort()}),e.addListener("error",function(t){return e.onerror(t)}),e}var p,d,g=((p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(y,d=i),y);function y(){return d.call(this)||this}var v,b,B=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),w=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var a=arguments[e],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},L=(B(m,b=g),m.prototype.init=function(t,e){var r=(e||{color:"black"}).color;this.canvas=document.createElement("canvas");var n=this.canvas.getContext("2d");n?(this.context=n,this.canvas.width=devicePixelRatio*Math.max(window.screen.width,window.screen.height),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.height=t.clientHeight,this.halfHeight=.5*this.canvas.height,this.color=r||"black",this.reset(),t.appendChild(this.canvas)):console.warn("cont get Context2D from canvas")},m.prototype.setColor=function(){var o,a=this;this.color instanceof Array?(o=this.context.createLinearGradient(0,this.halfHeight,this.canvas.width,this.halfHeight),this.color.forEach(function(t,e){var r,n;"string"==typeof t?o.addColorStop(e/(a.color.length-1),t):(r=t.offset,n=t.value,o.addColorStop(r,n))})):o=this.color,this.context.strokeStyle=o},m.prototype.reset=function(){this.setColor()},m.prototype.render=function(t,e,r){for(var o=this,a=[],n=0;n<t.numberOfChannels;n++)a.push(t.getChannelData(n));var i=Math.floor(this.canvas.width*e),s=Math.floor(this.canvas.width*r)-i||10,c=Math.floor(a[0].length/s)||1;this.context.beginPath(),this.context.lineWidth=.5;for(var f=this,n=0;n<=s;n+=.25)!function(t){var e=i+t,r=Math.floor(c*t),n=Math.max.apply(Math,w([.7],a.map(function(t){return Math.abs(o.halfHeight*t[r])})));f.context.moveTo(e,f.halfHeight+n),f.context.lineTo(e,f.halfHeight-n)}(n);this.context.stroke()},m.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},m);function m(){return null!==b&&b.apply(this,arguments)||this}function O(t,n,o){return t.forEach(function(t,e){var r=o?o+"["+e+"]":""+e;t instanceof Array?n=O(t,n,r):t instanceof Object?n=D(t,n,r):n+=n?"&"+r+"="+t:r+"="+t}),n}function D(t,e,r){for(var n in t){var o=t[n],a=r?r+"["+n+"]":""+n;o instanceof Array?e=O(o,e,a):o instanceof Object?e=D(o,e,a):e+=e?"&"+a+"="+o:a+"="+o}return e}var P,_,x=(P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),R=function(){return(R=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},A={Decorder:u,Render:L,DataTransformer:function(t,e,r){var n,o;return t=t||"",e="GET"===(r=r||"GET")?(t=t+"?"+(e=e instanceof FormData?null:(o="",(n=e)instanceof Array?o=O(n,o,""):n instanceof Object&&(o=D(n,o,"")),o)),null):e instanceof FormData?e:JSON.stringify(e),fetch,{url:t,fetchOptions:{body:e,method:r,credentials:"same-origin"}}}},T=(x(C,_=i),C.use=function(t){var e=Object.keys(t||{}).filter(function(t){return!A[t]});if(e.length)throw"[ "+e.join(" , ")+" ] is not support.";A=R(R({},A),t)},C.plugins=function(){return R({},A)},C.prototype.init=function(t,e){this.plugins=R({},A);var r=(e||{color:"",scalable:!1}).color;this.render=new this.plugins.Render,this.render.init(t,{color:r})},C);function C(){var t=_.call(this)||this;return t.setTriggerProcesser("error",function(t){return t}),t.setTriggerProcesser("abort",function(){return null}),t.setTriggerProcesser("click",function(t){return{totalPercent:t.viewPercent||0}}),t.setTriggerProcesser("wheel",function(t){return{totalPercent:t.viewPercent||0,startPercent:0,endPercent:1,isScale:!0}}),t}var j,E,M=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),S=function(){return(S=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},U=function(t,i,s,c){return new(s=s||Promise)(function(r,e){function n(t){try{a(c.next(t))}catch(t){e(t)}}function o(t){try{a(c.throw(t))}catch(t){e(t)}}function a(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}a((c=c.apply(t,i||[])).next())})},k=function(r,n){var o,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=2&e[0]?a.return:e[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,e[1])).done)return i;switch(a=0,i&&(e=[2&e[0],i.value]),e[0]){case 0:case 1:i=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,a=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){s.label=e[1];break}if(6===e[0]&&s.label<i[1]){s.label=i[1],i=e;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(e);break}i[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],a=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},I=(M(H,E=T),H.create=function(t,e){if(t instanceof HTMLElement){var r=new this;return r.init(t,e),r}throw"Type ERROR: container "+t+" must be HTMLElement!"},H.prototype.load=function(t,e){var r=this.createDecoder(),n=e||{data:null,method:null},o=n.data,a=n.method;this.loadAudio(r,t||"",o,a||"GET")},H.prototype.loadBlob=function(t){var e=this.createDecoder();e.decode(t),this.append=function(t){t&&e.appendBuffer(t)}},H.prototype.createDecoder=function(){var a=this;if(this.decoder&&this.decoder.abort(),this.plugins.Decorder)return this.decoder=new this.plugins.Decorder,this.render.clear(),this.render.reset(),this.decoder.onprocess=function(t){var e=t.audioBuffer,r=t.startTime,n=t.endTime,o=t.duration;a.render.render(e,r/o,n/o)},this.decoder.onerror=function(t){a.onerror(t),a.trigger("error",t)},this.decoder;throw"Decorder can not be "+this.decoder+"."},H.prototype.append=function(t){},H.prototype.abort=function(){this.decoder&&this.decoder.abort(),this.trigger("abort"),this.onabort()},H.prototype.onerror=function(t){console.error(t)},H.prototype.onabort=function(){},H.prototype.loadAudio=function(g,y,v,b){return U(this,void 0,void 0,function(){var e,r,n,o,a,i,s,c,f,h,u,l,p,d=this;return k(this,function(t){switch(t.label){case 0:if(e=window.AbortController&&new AbortController||{signal:null,abort:function(){}},r=e.signal,!this.plugins.DataTransformer)return[3,10];n=this.plugins.DataTransformer(y,v,b),o=n.url,a=n.fetchOptions,i=S({signal:r,method:b},a),g.addListener("abort",function(){e.abort()}),t.label=1;case 1:return t.trys.push([1,8,,9]),[4,fetch(o,i)];case 2:return(s=t.sent()).ok?(c=s.body)?(f=c.getReader(),g.addListener("abort",function(){f.cancel().catch(d.processError)}),h=function(){return U(d,void 0,void 0,function(){var e,r,n;return k(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,f.read()];case 1:return(e=t.sent()).done||(r=new ArrayBuffer(e.value.length),new Uint8Array(r).set(e.value),g.appendBuffer(r),h()),[3,3];case 2:return n=t.sent(),this.processError(n),[3,3];case 3:return[2]}})})},[4,f.read()]):[3,4]:[3,6];case 3:return(u=t.sent())&&u.value&&(l=new ArrayBuffer(u.value.length),new Uint8Array(l).set(u.value),g.decode(l)),h(),[3,5];case 4:console.warn("no response body."),t.label=5;case 5:return[3,7];case 6:this.onerror(new Error("Request Error:  "+s.status+", url is [ "+o+" ].")),t.label=7;case 7:return[3,9];case 8:return p=t.sent(),this.processError(p),[3,9];case 9:return[3,11];case 10:throw"DataTransformer Can not be "+this.plugins.DataTransformer;case 11:return[2]}})})},H);function H(){var t=E.call(this)||this;return t.processError=function(t){"AbortError"!==t.name?console.error(t):console.warn("WaveRolling load canceld.")},t}}],o.c=n,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0);function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}var r,n});